# FG8/Frourio 変分原理 実装計画（P18）

本書類は、papers/ および現状の Lean 実装全体（Frourio/*）を踏まえ、フルーリオ数学における最小フルーリオ作用原理（PLFA）＝EDE＝EVI＝JKO の同値と、その周辺定理群（Doob 変換、Mosco 極限、two‑EVI、Young 剛性、m点多スケール較正）を Lean 上で完証するための残タスクを体系化した設計メモである。

## ゴール（到達判定）
- PLFA＝EDE＝EVI＝JKO 同値の完全実装（papers/m点幾何学8.md の定理 2.1/3.2 相当）。
- Doob 変換の曲率劣化と EVI 定数更新（λ_BE＝λ−2ε）の形式化（papers §2/§C）。
- m点フルーリオ項 D_{σ,m} に対する (K1′) 狭義連続、(K4^m) 変位親和（基本モデルは証明、一般は仮定）と、強上界（slope）の実装（papers §1）。
- two‑EVI（外力）と with‑error 版の収縮不等式の導出（papers §5/§D）。
- Mosco 極限での定数 liminf 安定（papers §4）。
- Young 畳み込み等号剛性（papers §6）の Lean 化（L^2×TV→L^2）。
- 乗法スケール則・テンソル化（min 則）の実装（papers §1/付録A）。

以降、モジュール別に残タスクを列挙する。

## 1. Analysis/EVI.lean（EVI 骨格）
現状は API 形の述語・補題ラッパが多く、定理は Predicate を引数に取る形で温存されている。以下を「証明付き定理」に差し替える。

- Dini 上側微分の基本則
  - [ ] `DiniUpper_add_le_pred` → `DiniUpper (φ+ψ) ≤ DiniUpper φ + DiniUpper ψ` の実証。
  - [ ] `DiniUpper_timeRescale_pred` → 正のスケール σ に対する時間再標定の法則の実証（右極限での連続性／有界性の補題整備）。
- グロンウォール（均質・非均質）
  - [ ] `gronwall_exponential_contraction_pred` 等の Predicate を取り除き、直接の定理として実装。
  - [ ] with‑error（1/2 版）も EVI 収縮への橋渡しとして完成。
- 距離二乗→距離の橋渡し
  - [ ] `Hbridge_concrete` と `bridge_contraction_concrete` を完全定理化（sqrt の単調性・指数の半分化・積の平方根の正規化）。
  - [ ] with‑error 版の橋渡しも整理。
- two‑EVI（外力）
  - [ ] Geodesic 一様評価（papers §5）の仮定を Lean 述語化し、`evi_two_sync_sq_with_error`→`evi_two_sync_with_error_dist` の連鎖を完成。
- Mosco スケルトン
  - [ ] `MoscoSystem`/`MoscoM1,M2,Tight` の最小実装から、実際の EVILimitHolds に向けた補題（狭義収束＋2次モーメント緊性＋Ent の l.s.c.）を追加。

## 2. Analysis/PLFACore.lean（非距離部）
papers §1～§3 の「フラグ→同値」の一般枠。

- [ ] 既存の PLFA/EDE/JKO/フラグ群の API を維持しつつ、非距離系で完結する補題（EDE の時間シフト、forward difference 非正等）を証明形式で固める（現状済の微修正/整形は完了）。
- [ ] `PLFA_EDE_from_analytic_flags`, `JKO_PLFA_from_analytic_flags` からのビルダー（pack 生成）ルートを unit test 的に exercise（Examples.lean 等）。
- [ ] `jko_to_ede_from_flags`（非距離内に移管済み）を活用し、Bridges に依存しない最短ルートを確立。

## 3. Analysis/PLFA.lean（距離・EVI 部）
- [ ] `EDE_EVI_pred`/`plfaEdeEviJko_equiv` の実体化（Core のフラグから EDE⇔EVI を導出）。
- [ ] `build_package_from_global` の依拠する `GlobalSufficientPack`（PLFA_EDE_pred ∧ EDE_EVI_pred ∧ JKO_to_PLFA_pred）を埋めるため、EVI.lean の項目 1 のグロンウォール・橋渡しを先行実装。
- [ ] `TwoEVIWithForce` を EVI.lean の with‑error 連鎖と整合させる（最短測地点での双対評価の Lean 化）。

## 4. Analysis/KTransform.lean（K 側の仮想カーネル）
- [ ] (K1′) 狭義連続の Lean 化：`UniformLowerBoundAtZero` から FrourioFunctional 側 coercivity への橋渡しは実装済。`K1primeK` を具体例（basic1D）以外にも供給できるよう、一般テンプレートを設計。
- [ ] (K4^m) 変位親和（displacement affinity）の述語化・基本モデルでの証明（papers 付録Aを Lean 化）。
- [ ] `DsigmamFromK` と `FrourioFunctional.ofK` の収束・有界性の補題を追加（PLFA 側 l.s.c.／coercive の自動証明を補助）。

## 5. Analysis/DoobTransform.lean
- [ ] `cd_parameter_shift_explicit` を True 断言から、`HessianLogBound` と CD の仮定の下での実証に置き換え（Bochner 型等式の最小版を用意）。
- [ ] `gamma_eq`/`gamma2_eq` 等の同一視は、当面は仮定扱いだが、可能な範囲で演算子レベルの補題（`doobL` と Γ の両立）を追加。

## 6. Analysis/FrourioFunctional.lean
- [ ] slope の定義（現在 0 のダミー）を「勾配流の局所スロープ（AGS の定義）」へ差し替え可能な形で抽象化。直ちに差し替えられない場合は、slope=0 版の上に、仮定を明示した strong upper bound の派生を保持。
- [ ] `lambdaEffLowerBound_from_doob_explicit_mpoint` の証明から、`cd_parameter_shift_explicit` の更新内容を反映（`HasCD` を True から実体へ）。
- [ ] `AnalyticFlags` 生成のテンプレート強化：`analytic_flags_for_F_from_K` 経路で (K1′)・(K4^m)・非負性から PLFA 側の旗群をまとめて生成。

## 7. Geometry/FGTheorems.lean, Geometry/GradientFlowFramework.lean
- [ ] スケール規則（相似/等長）: `evi_scale_rule_*` は設計通り。証明には EVI.lean の時間再標定・距離スケーリング補題が必要。相似の場合の `λ_eff=Λ^{(κ-2α)k}λ` を Lean で算術化。
- [ ] `flow_suite_from_*` 群の背後にある `build_package_from_flags_and_bridges` ルートを、上記実装の完成後に「証明付き」へ移行（今は設計通り合成の配線確認）。
- [ ] two‑EVI（外力）系の API と EVI.lean 実装の同期（仮定 “全測地に一様” の Lean 述語を共有）。

## 8. Mellin/Sobolev/Young（Analysis/Mellin*, Young*）
- [ ] `D_{Φ,Λ}` のノルム等式（papers §7）を H_σ→H_{σ-1} の恒等として実装（Mellin 記号・作用域の補題を整理）。
- [ ] Young 畳み込みの等号剛性（L^2×TV→L^2）を Lean 化（既存の Young 不等式を援用）。

## 9. Mosco（EVI.lean の最小版を拡充）
- [ ] `MoscoM1/M2/Tight` を Entropy と Dirichlet 形式の設定で満たす sufficient conditions を追加。
- [ ] `eviInheritance` を `EVILimitHolds`（EVI の極限保持）に昇格：JKO 緊性と EDE/EVI の安定性の定理群を移植。

## 10. スケジュール案（優先順位）
1) EVI.lean の微分・グロンウォール・橋渡し（距離二乗→距離）を確定（上流の全レイヤーが依存）。
2) PLFA.Core の非距離部分を固め、Bridges への入力（PLFA_EDE_pred, JKO_to_PLFA_pred）を充実。
3) FrourioFunctional/KTransform/DoobTransform の三者連携（λ_eff 下界ルート）を証明へ移行。
4) FGTheorems/GradientFlowFramework の合成系を「証明付き」へ段階更新。
5) Mosco／two‑EVI／Young 剛性を順次追加、papers の全主張を網羅。

## 11. 受け入れ基準（Definition of Done）
- Lean で `lake build` 完走、警告ゼロ（または残存は style 系のみ、かつ設計上意図的であることを注記）。
- PLFA＝EDE＝EVI＝JKO の各方向に対する Lean 定理が存在し、papers の記述と一致する係数（λ_eff, λ_BE, スケール指数）。
- Doob 変換、Mosco 極限、two‑EVI、Young 剛性、テンソル化・スケール則について、papers の数式が Lean 定理として確認できる。
- Examples.lean 等に最小のサンプル（basic1D モデルなど）を追加し、定数の動きを具体例で検証できる。

以上。
