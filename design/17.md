# FG8 変分原理（PLFA＝EDE＝EVI＝JKO）証明タスク計画 v2（最終到達版のためのTODO）

目的: papers/ と現状の Lean 実装を踏まえ、Frourio 幾何（FG8）の変分原理（PLFA＝EDE＝EVI＝JKO 同値）と関連定理群（λ_eff 下界、two‑EVI、Mosco‑liminf、テンソル化、多スケール）を「命題パッケージ」から「定理（証明付き）」へ引き上げるための具体タスクを整理する。

対象: Frourio/Analysis/*, Frourio/Geometry/*, papers/*.md

---

## 1. 要旨（papers の要点 → Lean 目標）

- FG（m点較正）の枠組みで CD(λ,∞) ⇒ MLSI(λ) ⇒ EVI(λ)。スケール作用の下で λ の有効係数 λ_eff を算出（等長/相似）。Doob 変換は曲率補正で λ→λ−2ε（十分条件）。Mosco 極限で定数 liminf 安定。two‑EVI 同期、Young 畳み込み等号剛性。解析アンカー D_{Φ,Λ}（Mellin 記号・ノルム等式）。
- FG8（m点版）では F:=Ent+γ·𝒟_{σ,m} について PLFA＝EDE＝EVI＝JKO の同値、Doob と m点項を分離評価した λ_eff 下界、two‑EVI（外力）、Mosco‑liminf、テンソル化（min）、多スケール則（ℤ^m）を主張。
- Lean 目標: 既存の Prop スケルトンを、(i) 実解析（ディニ・グロンウォール）、(ii) 変分（半凸・強上界・JKO）、(iii) Doob（Γ–Γ₂ 補正式）、(iv) K/𝒟_{σ,m}（l.s.c./変位半凸・強上界）で埋め、設計済みの FG レイヤの窓口から一括で呼び出せるようにする。

---

## 2. 現状ギャップと優先修正ポイント（コード参照）

- ディニ上側微分の基本補題が `admit`（証明欠落）。
  - `Frourio/Analysis/EVI.lean:29` DiniUpper_nonpos_of_nonincreasing … 証明を追加。
- ディニの合成・加法・時間再標定は述語（Pred）依存。
  - `Frourio/Analysis/EVI.lean:55` DiniUpper_timeRescale_pred → 定理化。
  - `Frourio/Analysis/EVI.lean:64` DiniUpper_add_le_pred → 定理化。
- グロンウォールは述語プレースホルダ。
  - `Frourio/Analysis/EVI.lean:73` gronwall_exponential_contraction_pred → 定理化。
  - `Frourio/Analysis/EVI.lean:81` gronwall_exponential_contraction_with_error_half_pred → 定理化。
- EDE ⇔ PLFA の片向きのみ実装（PLFA→EDE）。
  - `Frourio/Analysis/PLFA.lean:82` EDE_to_PLFA_bridge → 証明を与え、PLFA⇔EDE を theorems 化。
- JKO ⇒ PLFA/EDE/EVI はフラグ経由のラッパのみ。proper/l.s.c./coercive の中身が抽象。
  - `Frourio/Analysis/PLFA.lean:234` AnalyticFlags 等のフラグを、最小モデルで実体化する補題群を追加。
- Doob 変換は CD シフトを仮定パックに依存。
  - `Frourio/Analysis/DoobTransform.lean:85` cd_parameter_shift を ε による劣化 λ'≤λ の「明示式」へ（∇²log h ≤ εg から λ−2ε）。
- λ_eff 下界は不等式のラップのみ。
  - `Frourio/Analysis/FrourioFunctional.lean:73` lambdaEffLowerBound → Doob の明示シフトと m点 0 次評価（‖S_m‖_∞, ‖Ξ_m‖）を仮定にして定理化。
- 𝒦 と 𝒟_{σ,m} はモック。l.s.c./変位半凸/強上界はプレースホルダ。
  - `Frourio/Analysis/KTransform.lean:13` KTransform に狭義連続 (K1′) の実体、
  - `Frourio/Analysis/FrourioFunctional.lean:137` StrongSlopeUpperBound_pred の構成補題（K 側の (K1′)(K4^m) と非負仮定から）。
- Mosco は liminf/回復が最小形。
  - `Frourio/Analysis/EVI.lean:603` EVILimitHolds と `:611` eviInheritance を EVI の継承（JKO 極限）へ強化。

---

## 3. 実装タスク（フェーズ順）

A. 実解析（Dini/Grönwall）
- A1: 証明: 非増加関数の上側ディニ ≤ 0（`EVI.lean:29`）。
- A2: 定理: 時間再標定 `t↦σt`（`EVI.lean:55`）と加法上界（`EVI.lean:64`）。
- A3: 定理: グロンウォール（同次/非同次 half 版、`EVI.lean:73,81`）。
- A4: 橋渡し: 平方距離 → 距離（既存の `bridge_contraction_concrete` を利用; sqrt/exp 補題の補強）。

B. 変分原理（PLFA＝EDE＝EVI）
- B1: 証明: EDE→PLFA（ディニ≤0 ⇒ 単調非増）（`PLFA.lean:82`）。
- B2: 枠組: 半凸＋強上界の抽象から EDE⇔EVI（`PLFA.lean` 既存 API を theorem 化）。
- B3: JKO ⇒ PLFA（proper/l.s.c./coercive の最小核で）と JKO ⇒ EDE/EVI ブリッジ。

C. Doob と λ_eff 下界
- C1: Doob: Γ–Γ₂ の補正式の型付けを維持しつつ、`cd_parameter_shift` に (∇²log h ≤ εg) ⇒ λ'≥λ−2ε を追加（新定理）。
- C2: `FrourioFunctional.lean:73` の λ_eff 不等式を、C1 と m点 0 次評価（`MPointZeroOrderBound`）から導出する定理化（既存 wrapper の中身を埋める）。

D. 𝒦/𝒟_{σ,m} 層
- D1: (K1′) 狭義連続の具体化（基本モデル: 1D 等長化の線形作用）。
- D2: (K4^m) 変位親和の基本モデル証明（Zak–Mellin 多繊維）。
- D3: 強上界: `StrongSlopeUpperBound_pred` を K 側仮定＋非負パラメタから構成（`FrourioFunctional.lean:154` の枠詳細化）。

E. Mosco/JKO 極限とテンソル化
- E1: Mosco: (M1/M2/Tight/l.s.c.) から EVI 継承を theorem 化（`EVI.lean:611`）。
- E2: テンソル化（min 則）のパッケージを Prop から theorem へ（必要条件は K1′ と γ≥0）。

F. two‑EVI（外力）
- F1: eviSumWithError から平方距離版の非同次グロンウォール適用（既存 skeleton の強化）。
- F2: 誤差付き距離版への橋渡し（既存 `HbridgeWithError` の具体化）。

---

## 4. 受入基準（Done の定義）

- AC1: `EVI.lean` の A1–A3 が `theorem` として実装され、`admit/Pred` 依存が消える。
  - 参照: `Frourio/Analysis/EVI.lean:29`, `:55`, `:64`, `:73`, `:81`。
- AC2: `PLFA.lean` で PLFA⇔EDE が `theorem`（B1 完了）、EDE⇔EVI/JKO⇒PLFA が flags から導出可能（B2–B3）。
  - 参照: `Frourio/Analysis/PLFA.lean:73`, `:82`, `:234`。
- AC3: `DoobTransform.lean` に λ' = λ − 2ε の明示版（仮定: ∇²log h ≤ εg）を追加し、`FrourioFunctional.lean:73` の λ_eff 下界を定理で実装（C1–C2）。
- AC4: `KTransform.lean` と `FrourioFunctional.lean` の K 側仮定から強上界を供給（D1–D3）。
- AC5: `EVI.lean:611` の Mosco 継承が theorem 化（E1）。
- AC6: `Geometry/GradientFlowFramework.lean` のスイート系 (`gradient_flow_suite`, `flow_suite_*`) が、上記 theorems のみで組めること（外部 Pred 不要）。
- AC7: `Frourio.lean` import でビルド通過、`sorry/admit/axiom` 不使用。

---

## 5. 実装順序（短期ロードマップ）

1) A（Dini/Grönウォール 基礎）→ 2) B（PLFA⇔EDE⇔EVI・JKO）→ 3) C（Doob・λ_eff）→ 4) D（K/𝒟_{σ,m}）→ 5) E（Mosco/テンソル化）→ 6) F（two‑EVI）→ 7) 仕上げ（FG 窓口統合動作確認）。

---

## 6. 具体 TODO（ファイル単位）

- `Frourio/Analysis/EVI.lean:29` 非増加 ⇒ Dini 上側 ≤ 0（フィルタ極限で証明）。
- `Frourio/Analysis/EVI.lean:55` 時間再標定（連鎖・置換）を証明に置換。
- `Frourio/Analysis/EVI.lean:64` 加法上界（limsup の劣加法性）を証明に置換。
- `Frourio/Analysis/EVI.lean:73,81` グロンウォール（同次・非同次 half）の実装（AC 曲線版で十分）。
- `Frourio/Analysis/PLFA.lean:82` EDE→PLFA（Dini≤0 ⇒ 単調非増）を証明に置換。
- `Frourio/Analysis/PLFA.lean` 半凸＋強上界から EDE⇔EVI、proper/l.s.c./coercive＋JKOStable から JKO⇒PLFA を theorem 化。
- `Frourio/Analysis/DoobTransform.lean:85` cd_parameter_shift に λ−2ε 版を追加（新定理; 既存の抽象版は併存）。
- `Frourio/Analysis/FrourioFunctional.lean:73` λ_eff 下界を Doob 明示シフト＋0次評価から証明（既存 wrapper を活用）。
- `Frourio/Analysis/KTransform.lean` (K1′)(K4^m) の基本モデルを補強（1D 等長化 + 線形性）。
- `Frourio/Analysis/EVI.lean:603,611` Mosco 継承を liminf/回復/緊性＋l.s.c. 仮定から JKO 連続化極限で theorem 化。
- `Frourio/Geometry/FGTheorems.lean` two‑EVI 距離版の bridge を concrete lemma で提供（既存フックに証明を与える）。

---

## 7. リスクと緩和

- 測度/OT の一般性が重い → まず基本モデル（1D, Zak–Mellin）の (K1′)(K4^m) を定理化し、抽象化は段階的に持ち上げる。
- JKO 収束の技術 → proper/l.s.c./coercive の最小核＋AC 曲線での弱定式化で first pass。将来的に measure-theoretic 補強。
- Doob の曲率補正式 → 3 行導出（papers/代数学.md）に忠実な最小版（∇²log h ≤ εg ⇒ λ−2ε）から開始。

---

## 8. 参考（papers → 実装トレース）

- スケール則・Doob 可換: `papers/m点幾何学1-7.md:1`。FG窓口: `Frourio/Geometry/FGCore.lean:1`, `FGTheorems.lean:1`。
- 変分原理・λ_eff 下界・two‑EVI: `papers/m点幾何学8.md:1`。分析層: `Frourio/Analysis/PLFA.lean:1`, `EVI.lean:1`, `FrourioFunctional.lean:1`。
- Doob 曲率補正: `papers/代数学.md:1`。実装: `Frourio/Analysis/DoobTransform.lean:1`。

---

本ドキュメントは design/16.md の残タスク設計を前提に、証明の「どこを埋めるか」を行単位で明示した最終到達版の TODO である。上記 AC1–AC7 を満たせば、FG8 の変分原理は Lean 上で「証明済み」として成立する。

