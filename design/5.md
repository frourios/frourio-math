# フルーリオ代数学 LEAN4実装 第5フェーズ設計書（P2 詳細）

バージョン: 1.0
対象期間: Phase P2（Mellin 解析：変換・記号・ノルム・零点）
担当: 開発/形式化チーム

## 0. 目的とスコープ

- 目的: Φ差分作用素の Mellin 記号を厳密（または仮定付き）に同定し、垂線空間 H_σ における有界性評価と零点格子の記述を与える。黄金極値（P3/P4）の準備を整える。
- スコープ: `Frourio/Analysis/MellinTransform.lean` 新設。Mellin 変換の定義（必要に応じて仮定/クラスで制御）、スケーリング法則、x 分母によるシフト、Φ差分の記号、零点集合、ノルム上界の設計・実装。EVI や Mosco は対象外。

## 1. 現状とギャップ

- 既存
  - Frourio 作用素の抽象的記号 `mellinSymbol`（設計上の別物）あり。`Frourio/Algebra/Properties.lean`
  - `phiDiff` の定義と一次 Leibniz。`Frourio/Algebra/StructureSequence.lean`
- ギャップ
  - Mellin 変換そのものの定義・法則（スケーリング/シフト）不在。
  - Φ差分の Mellin 記号（および零点格子）の形式化不在。
  - H_σ ノルムと記号の上界評価、Λ に関する単調性の整理が未実装。

## 2. 成果物（Deliverables）

- D1: Mellin 変換の枠組み
  - 定義 `mellinTransform (f : ℝ → ℂ) (s : ℂ) : ℂ`（積分定義）。
  - ドメイン制御クラス `MellinDomain f`（あるいは仮定パック）: 可積分性・Fubini 許容性を規定。
  - 基本法則（仮定付き）
    - Scaling: `α > 0 → M[f(α·)](s) = α^{-s} M[f](s)`
    - Shift by 1/x: `M[ g(x)/x ](s) = M[g](s+1)`
- D2: Φ差分の Mellin 記号
  - 記号 `ϑ_Φ(Λ,s) := (Λ^{-s} - Λ^{s}) / (Λ - Λ^{-1})`（Λ>0, Λ≠1 を想定）。
  - 等式（仮定付き）`: M[phiDiff Λ f](s) = ϑ_Φ(Λ,s) · M[f](s+1)`。
- D3: 零点格子・間隔
  - `mellinZeros(Λ) := { s | ∃ k : ℤ, s = (Complex.I * Real.pi * k) / Real.log Λ }`（Re(s)=0 線上の格子）。
  - `ϑ_Φ(Λ,s) = 0 ↔ s ∈ mellinZeros(Λ)`（Λ>1 仮定の下）。
  - 間隔 `Δt = π / log Λ` の導出。
- D4: H_σ のノルム評価
  - 垂線空間のモデル: `VerticalLine σ := { s : ℂ // s.re = σ }` とし、`H_σ` を `L2(ℝ)` と同一視（`t ↦ σ+it` で引き戻し）。
  - 作用素 `T_{Φ,Λ} : H_σ → H_{σ-1}` の有界性: `∥T_{Φ,Λ}∥ ≤ sup_{t∈ℝ} |ϑ_Φ(Λ,σ+it)|`。
  - 明示上界: `|ϑ_Φ(Λ,σ+it)| ≤ (Λ^{σ} + Λ^{-σ}) / (Λ - Λ^{-1}) = 2 cosh(σ log Λ) / (Λ - Λ^{-1})`。
  - Λ に関する単調性: `σ ≥ 0` 固定で `cosh(σ log Λ)` は Λ 単調増、分母 `Λ - Λ^{-1}` も Λ 単調増。比の挙動は別補題（後述の極値準備）。

## 3. 仕様（API/補題の型：案）

- D1: Mellin 基本
  - `noncomputable def mellinTransform (f : ℝ → ℂ) (s : ℂ) : ℂ := ∫ x in Ioi 0, f x * (x : ℝ)^(s-1)`
    - 備考: 実装では `Real`→`ℝ≥0∞` 変換や `MeasureTheory` を用いる。設計段階ではインターフェースを先行確定。
  - `class MellinDomain (f : ℝ → ℂ) : Prop := ...`（可積分性・有界性等、段階的に拡張）
  - `theorem mellin_scaling (hα : 0 < α) (hf : MellinDomain f) :
      mellinTransform (fun x => f (α * x)) s = (α : ℝ) ^ (-s) * mellinTransform f s`
  - `theorem mellin_div_x (hf : MellinDomain g) :
      mellinTransform (fun x => g x / x) s = mellinTransform g (s+1)`

- D2: 記号と Φ差分
  - `noncomputable def phiSymbol (Λ : ℝ) (s : ℂ) : ℂ := ((Λ : ℝ) ^ (-s) - (Λ : ℝ) ^ (s)) / ((Λ : ℝ) - (1/Λ))`
  - `theorem mellin_phiDiff (hΛ : 0 < Λ) (hΛ1 : Λ ≠ 1)
      (hf : MellinDomain f) :
      mellinTransform (phiDiff Λ f) s = phiSymbol Λ s * mellinTransform f (s+1)`

- D3: 零点格子
  - `def mellinZeros (Λ : ℝ) : Set ℂ := { s | ∃ k : ℤ, s = (Complex.I * Real.pi * k) / Real.log Λ }`
  - `lemma phiSymbol_zero_iff (hΛ : 1 < Λ) :
      phiSymbol Λ s = 0 ↔ s ∈ mellinZeros Λ`
  - `lemma zero_spacing (hΛ : 1 < Λ) :
      ∀ k, (mellinZeros Λ).reprGap k = Real.pi / Real.log Λ`（表現的に `reprGap` は記法の意）

- D4: 作用素ノルム
  - `def VerticalLine (σ : ℝ) := { s : ℂ // s.re = σ }`
  - `noncomputable def Hσ (σ : ℝ) := { F : ℝ → ℂ // MeasureTheory.Memℒp F 2 }`（実装は軽量化可）
  - `def Tphi (Λ : ℝ) (σ : ℝ) : Hσ σ → Hσ (σ-1)` を Mellin 領域での乗算としてモデル化（実装では等長同定を介して定義）
  - `theorem op_norm_bound (hΛ : 1 < Λ) (σ : ℝ) :
      ∥Tphi Λ σ∥ ≤ 2 * Real.cosh (σ * Real.log Λ) / (Λ - Λ⁻¹)`

- 単調性・極値準備（設計）
  - `lemma cosh_mono_in_logΛ (hσ : 0 ≤ σ) : Monotone (fun Λ => Real.cosh (σ * Real.log Λ))`（`Λ>1`）
  - `lemma denom_mono : Monotone (fun Λ => Λ - Λ⁻¹)`（`Λ>1`）
  - 比に関しては `σ` と探索範囲を固定して評価（黄金比の極値は P3/P4 へ）

## 4. 実装手順（Tasks）

1) ファイル新設と最小インターフェース
- `Frourio/Analysis/MellinTransform.lean` を新設。
- `mellinTransform` の署名と `MellinDomain` クラスを追加（詳細は段階的）。

2) 法則（Scaling/Shift）のステートメント化
- まず `theorem` 形で置き、必要仮定をパック化（`MellinDomain`）。
- 実装が重くなる場合、証明は後回し（`TODO` 注記、将来的に mathlib の Mellin 補題採用）。

3) Φ差分の記号導出
- Scaling と Shift を用いて `mellin_phiDiff` を証明。
- 記号 `phiSymbol` の零点集合 `mellinZeros` を定義し、代数的に同値性を示す。

4) H_σ モデルとノルム上界
- `VerticalLine` と `Hσ` の軽量モデル化（完全な関手的同一視は後回し）。
- 乗算作用素の有界性: `sup_t |phiSymbol(σ+it)|` 上界を与え、`2 cosh(σ log Λ) / (Λ - Λ^{-1})` を導く。

5) 単調性の補題（準備）
- cosh/denominator の Λ 単調性を分離補題として実装。
- 比の挙動は観察補題（`simp` と基本微分・不等式を使う準備）に留める。

## 5. 依存関係と影響範囲

- 依存: `StructureSequence.lean`（Φ差分の定義）
- 影響: 新規ファイル追加のみ。既存 API に破壊なし。
- mathlib: `MeasureTheory`（積分）、`Complex`, `Real.log/exp`, `Real.cosh`。重い依存は段階導入。

## 6. 受入基準（Acceptance Criteria）

- AC1: `mellinTransform` と `MellinDomain` が定義され、Scaling/Shift のステートメントが配置済み。
- AC2: `phiSymbol` と `mellin_phiDiff`（仮定付き）が整備済み。
- AC3: `mellinZeros` と零点同値・間隔説明が提供済み（証明は代数部分を優先）。
- AC4: `op_norm_bound` の不等式が `σ, Λ` の仮定明示で記述されている（証明は段階的）。
- AC5: CI が通る（未証明箇所は `sorry` を置かない。設計段階では定義と `opaque`/`axiom` は避け、定理は未追加でもよい）。

## 7. リスクと緩和

- R1: 測度論が重く CI 時間を圧迫
  - 緩和: 設計段階では法則のステートメント化まで。実装では可積分性クラスで局所化し、重い補題は後フェーズ。
- R2: 記号の零点とノルムが混同
  - 緩和: 記号定義を明確化し、`(Λ^{-s} - Λ^{s})/(Λ - Λ^{-1})` という正規化を固定。
- R3: 単調性の比較が黄金極値へ直結しない
  - 緩和: 単調性は個別補題として準備し、極値は P3/P4 の設計にて別立て。

## 8. 命名規約とスタイル

- 命名: `mellinTransform`, `MellinDomain`, `mellin_scaling`, `mellin_div_x`, `phiSymbol`, `mellin_phiDiff`, `mellinZeros`, `op_norm_bound`。
- `@[simp]` は `phiSymbol` の基本代数整理に付与可。
- 実数パラメータ（Λ,σ）は仮定を引数先頭に集約。

## 9. マイルストーン

- M1: D1（定義と法則ステートメント）完了
- M2: D2（記号等式）・D3（零点集合）完了
- M3: D4（ノルム上界）・単調性準備完了

## 10. 実装メモ

- スケーリングとシフト
  ```lean
  -- M[f(α·)](s) = α^{-s} M[f](s)
  -- M[g/x](s)   = M[g](s+1)
  -- ⇒ M[phiDiff Λ f](s)
  --  = 1/(Λ - Λ⁻¹) * ( M[f(Λ·)/x](s) - M[f(·/Λ)/x](s) )
  --  = 1/(Λ - Λ⁻¹) * ( Λ^{-s} - Λ^{s} ) * M[f](s+1)
  ```
- 上界の導出
  ```lean
  -- s = σ + i t, a := Λ^σ > 0
  -- |Λ^{-s} - Λ^{s}| = |a^{-1} e^{-it log Λ} - a e^{it log Λ}|
  -- ≤ a^{-1} + a = 2 cosh (σ log Λ)
  ```
