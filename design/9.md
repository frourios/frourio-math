# フルーリオ代数学 LEAN4実装 第9フェーズ設計書（P6 総仕上げ：残タスク統合計画）

バージョン: 1.0
対象期間: Phase P6（papers/代数学.md とコードのギャップ解消）
担当: 開発/形式化チーム

## 0. 目的とスコープ

- 目的: 基盤論文（papers/代数学.md）の主要主張（Γ–Γ₂/Doob、EVI/Mosco、Young 剛性、Dirac 指数、m 点差分・σ-PBW）に対し、現状のスケルトン実装を整理し、残タスクを段階導入できる形で設計・配置する。
- スコープ: 既存スケルトン（P2〜P5）を踏まえた API の明文化、未配置の定理のステートメント化、証明の先送り（`sorry` 不使用）と仮定パック化。重い測度・幾何は次フェーズに委譲。

## 1. 現状とギャップ

- 解析（P2: Mellin）:
  - 既存: `phiSymbol` と零点同値は実装済。`mellinTransform`/`MellinDomain` は署名・コメントのみ、Scaling/1/x shift/作用素ノルム上界は未宣言またはコメント止まり。
- 代数（P3: Ore/σ-導分）:
  - 既存: `IsSigmaDerivation`、`OreSystem`、`ore_rewrite_one`、`matrixJordanId (σ=id)` あり。
  - ギャップ: 設計の `matrixJordan (σ)`（対角埋め込み）未実装、σ-PBW 多生成子版（Δ_i, σ_i, δ_i）の骨子未導入。
- EVI/Mosco/Doob/Young/Dirac（P4〜P5）:
  - 既存: EVI/Mosco/Doob/Young/Dirac は `Prop`/軽量定義でスケルトン配置。
  - ギャップ: EVI の時間領域（ℝ≥0）/Dini 上側微分の定義、Young(ℝ) の測度化・TV ノルム、Doob の Γ₂ 補正式、Dirac の幾何型、Mosco の (M1)/(M2) 述語など、設計に合わせた型の精緻化が未着手。
- 論文後半（m 点差分・Mellin–Sobolev・Nambu・Gate/PLFA=EDE=EVI=JKO、No-Go/近似二項化）:
  - 既存: m=2 の構造列・基本差分は整備。一方、m 点一般、S_m 記号、Bohr ほぼ周期、σ-PBW 拡大（多生成子）、Mellin–Sobolev 代数、Nambu 3-ブラケット、Gate 不等式、No-Go/近似二項化は未配置。

## 2. 成果物（Deliverables）

- D1: Mellin（P2 仕上げ＋m 点導入）
  - D1-1: `theorem mellin_scaling`/`mellin_div_x` のステートメント化（`MellinDomain` 仮定パック）。
  - D1-2: `op_norm_bound` のステートメント（`phiSymbolBound` を RHS に）。
  - D1-3: m 点記号 `S_m` と零集合・Bohr ほぼ周期の説明ステートメント（`Prop`）。
- D2: Ore/σ-PBW（P3 拡張）
  - D2-1: `OreSystem.matrixJordan (σ)`（対角埋め込み）を追加。
  - D2-2: 多生成子 `σ`-PBW 拡大のスケルトン（Δ_i, σ_i, δ_i とダイヤモンド臨界対リストの雛形）。
- D3: EVI/Mosco（P4 仕上げ）
  - D3-1: `DiniUpper` を下限定義へ近づけた skeleton（`sInf` 版、証明は later）。
  - D3-2: 時間領域 `ℝ≥0` 版のラッパと `evi_contraction` 署名（証明は後続）。
  - D3-3: `MoscoSystem` に (M1)/(M2)/`tightness` の述語型を追加（内容は `Prop`）。
- D4: Doob（P5 仕上げ）
  - D4-1: `doob_gamma_eq`/`doob_gamma2_eq` を等式 `Prop` として明文化（仮定パック `DoobAssumptions`）。
- D5: Young（P5 仕上げ）
  - D5-1: ℝ 版を測度 `Measure ℝ` と TV ノルムに差し替える薄いラッパ（`convR_measure`, `TVNorm`）。
  - D5-2: 剛性の片方向（Dirac ⇒ 等号）のステートメントを追加、Fourier 等号補題の署名を分離。
- D6: Dirac（P5 仕上げ）
  - D6-1: `isTorus2` を `Prop`→`class` へ移行予定の注記と API を整理。
  - D6-2: 指数公式の `Prop` を保持し、前提のタグを拡張可能に整理。
- D7: Mellin–Sobolev 代数（付録E 骨子）
  - D7-1: `Htimes s` のシグネチャと代数性・スケール作用のステートメント（`Prop`）。
- D8: Nambu 3-ブラケット（差分近似、付録C/§6 骨子）
  - D8-1: 差分導分族 `L_i` と FI 誤差評価のステートメント（作用域付き）。
- D9: No-Go/近似二項化（定理4.3/4.4 骨子）
  - D9-1: `Theorems/NoGoTheorem.lean` と `GoldenExtremality.lean` のステートメント雛形を追加。

## 3. 仕様（API/型：要点）

- Mellin: `class MellinDomain (f)` に可積分性・交換可能性のフィールドを将来拡張できる形で確保。`theorem mellin_scaling ... : Prop` として first-class に配置。
- Ore/σ-PBW: `OreSystem.matrixJordan (A) (σ)` は `algebraMap a = diagonal ![a, σ a]` のローカル `Algebra A (M₂ A)` を用意。σ-PBW は多生成子・順序・臨界対を列挙する型を用意。
- EVI: `DiniUpper` を `sInf` ベースで定義（証明は later）。`IsEVISolution` の引数は `ℝ≥0 → X` に合わせる wrapper を併置。
- Mosco: `(M1)/(M2)` を `Prop` として外出し、`MoscoAssumptions` に内包。
- Doob: `DoobAssumptions`（h>0, Leibniz など）を `Prop` でパック。
- Young: `convR_measure (f : ℝ → ℂ) (ν : Measure ℝ)` と `TVNorm (ν)` をスケルトン定義、L2 は `Prop` 不等式とする。
- Dirac: `DiracSystem` に `isTorus2` の型整理とコメントを追加。
- Mellin–Sobolev: `Htimes (s : ℝ)` と `algebraProp_Htimes s : Prop`（代数性/スケール評価）
- Nambu: `DiffBracket` と `FIErrorBound` の `Prop`。
- No-Go/Extremality: 定理署名のみ（`Prop`）。

## 4. 実装手順（Tasks）

1) Mellin: ステートメント（D1-1/D1-2）追加 → m 点記号のシグネチャ追加（D1-3）。
2) Ore: `matrixJordan (σ)` 追加（対角埋め込み）→ σ-PBW スケルトン（D2）。
3) EVI/Mosco: `DiniUpper(sInf)`・`ℝ≥0` ラッパ・`evi_contraction` 署名・(M1/M2) 述語（D3）。
4) Doob: 仮定パックと等式 `Prop` 明文化（D4）。
5) Young: 測度ラッパと剛性片方向の署名（D5）。
6) Dirac: 型整理の注記と API 微調整（D6）。
7) 付録系: `Htimes`/Nambu/No-Go/Extremality の署名配置（D7〜D9）。

## 5. 依存関係と影響範囲

- 依存: `MeasureTheory`/`Fourier`/`Topology`/`Calculus` は軽量採用（定義・署名中心）。
- 影響: 新規ファイル追加・署名追加が中心で既存 API に破壊なし。`simp` セットや linter は後追いで整理。

## 6. 受入基準（Acceptance Criteria）

- AC1: Mellin の基本法則・上界・m 点記号のステートメントが配置。
- AC2: `matrixJordan (σ)` と σ-PBW スケルトン（多生成子/臨界対型）が作成。
- AC3: EVI/Mosco の型が設計どおり（`DiniUpper(sInf)`・`ℝ≥0` ラッパ・(M1/M2) 述語）。
- AC4: Doob/Young/Dirac の仕上げ（仮定パック・測度ラッパ・型整理）が反映。
- AC5: 付録系（H^s_×、Nambu、No-Go/Extremality）の署名が配置。
- AC6: CI が通る（`sorry`/`opaque`/`axiom` 不使用）。

## 7. リスクと緩和

- 測度論・Fourier の導入でビルド時間増加 → スケルトン/`Prop` に留めて依存最小化。
- 対角埋め込み `Algebra A (M₂ A)` の型負担 → ローカルインスタンスと `simp` 補助で軽量化。
- 多生成子 σ-PBW の臨界対記述が肥大 → 型は最小限（列挙の器）に留め、内容は later。

## 8. 命名規約とスタイル

- 既存の設計名に合わせる（例: `evi_contraction`, `mellin_scaling`）。
- ステートメントのみの要素は `theorem … : Prop` や `def … : Prop` で表現し、`TODO` コメントで証明導入方針を明記。

## 9. マイルストーン

- M1: Mellin 仕上げ（D1）。
- M2: Ore/σ-PBW 拡張（D2）。
- M3: EVI/Mosco 型精緻化（D3）。
- M4: Doob/Young/Dirac 仕上げ（D4〜D6）。
- M5: 付録系ステートメント配置（D7〜D9）。

## 10. 参照（現行コードの主な位置）

- Mellin: `Frourio/Analysis/MellinTransform.lean`
- Ore/σ-導分: `Frourio/Algebra/CrossedProductCore.lean`
- EVI: `Frourio/Analysis/EVI.lean`
- Doob: `Frourio/Analysis/DoobTransform.lean`
- Young: `Frourio/Analysis/YoungConvolution.lean`
- Dirac: `Frourio/Geometry/DiracIndex.lean`
- 構造列・差分: `Frourio/Algebra/StructureSequence.lean`
- 論文: `papers/代数学.md`
