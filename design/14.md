# フルーリオ幾何学 変分原理 証明設計（FG8-Proofs）

バージョン: 1.0
対象: PLFA＝EDE＝EVI＝JKO の同値および λ_eff 下界・two-EVI・JKO 収束の「証明」方針
関連: design/10.md, design/11.md, design/12.md, design/13.md, papers/m点幾何学8.md

## 0. 目的と範囲

- 目的: FG8 で提示した変分原理の同値（PLFA, EDE, EVI, JKO）と安定性（λ_eff 下界、two-EVI、Mosco-liminf）を Lean で theorem 化する設計を定義する。
- 範囲: 既存の skeleton/API（EVI, Doob, m点, Mosco）を「仮定パック＋補助補題」で橋渡しし、`Prop` 接続から「theorem」へ段階昇格。測度論・OT の重負荷部分は抽象述語（連続性・半凸・強上界）で封じる。

## 1. 前提（Assumptions）

- 空間: 完備測地 `X`（Lean 側は `PseudoMetricSpace X` で抽象化）
- 解析: `EVIProblem X` と `IsEVISolution`、上側ディニ `DiniUpper` は既存 API（Frourio.Analysis.EVI）
- Doob: `DoobAssumptions h D` により CD 劣化 `λ_BE = λ-2ε` を確保（Frourio.Analysis.DoobTransform）
- m点: `S_m` の sup ノルム `‖S_m‖_∞`、Doob 交換子 `‖Ξ_m‖` を外生パラメタ化
- K 変換: (K1′) 狭義連続、(K4^m) 測地親和（基本モデルで保証、一般は述語）

## 2. 証明戦略（高レベル）

- A) EDE ⇔ EVI ⇔ PLFA（AGS 標準）
  - λ-半凸（本系では λ_BE 半凸）と局所スロープの強上界を前提に、
    - EDE → EVI: λ-傾き不等式と上側ディニの計算
    - EVI → PLFA: エネルギー散逸等式から作用極小性（EDP）への移送
  - 技術要素: 上側ディニの加法性・時間再標定、Grönwall、平方距離→距離の bridge

- B) JKO → EDE（→ EVI）
  - proper/l.s.c./coercive と λ_BE-半凸で各ステップの最小化列の存在
  - 離散エネルギー不等式と時間連続化から EDE、続いて A) で EVI

- C) λ_eff 下界
  - Doob による `λ_BE = λ-2ε` と m点項の 0 次摂動による劣化を分離
  - `λ_eff ≥ λ_BE - γ( c_*(σ)‖S_m‖_∞^2 + c_D(σ)‖Ξ_m‖ )` を EVI の λ に挿入

- D) two-EVI（外力）
  - 二曲線に EVI を適用→加算→交差項を測地に沿う上界 `η` で評価
  - Inhomogeneous Grönwall で平方距離版→bridge で距離版

- E) Mosco-liminf 安定
  - `MoscoAssumptions`（M1/M2/Tight + l.s.c.）の非自明化
  - `eviInheritance` を theorem 化し λ_eff の liminf 型不等式に接続

## 3. Lean 実装計画（モジュール別）

- E1: `Frourio/Analysis/EVI.lean` の強化（証明化）
  - `theorem DiniUpper_add_le`（加法上界）
  - `theorem DiniUpper_timeRescale`（時間再標定則）
  - `theorem gronwall_exponential_contraction`（同次版）
  - `theorem gronwall_exponential_contraction_with_error_half`（非同次版）
  - `theorem bridge_contraction`：平方距離収縮 ⇒ 距離収縮（`Real.sqrt` 単調性・代数補題群より）
  - `theorem eviContraction_thm` を上記補題で閉じる（追加仮定の明示化）

- E2: `Frourio/Analysis/PLFA.lean`（新規、定義＋同値）
  - 定義: `Action F ρ`, `PLFA F ρ`, `EDE F ρ`, `JKO F ρ0`
  - 定理: `theorem ede_iff_evi`, `theorem evi_iff_plfa`（λ-半凸＋強上界の仮定下）
  - 定理: `theorem jko_to_evi`（proper/l.s.c./coercive＋λ_BE-半凸の仮定下）

- E3: `Frourio/Analysis/FrourioFunctional.lean`（新規、機能関数と定数）
  - `structure FrourioFunctional`（`Ent`, `Dsigmam`, `gamma`, `F`）
  - 述語: `(K1′)`, `(K4^m)` の非自明化（最低1フィールド依存）
  - `def lambdaBE`, `structure ConstantBudget`,
    `theorem lambdaEffLowerBound`（λ_eff 下界の定理化：不等式として）
  - `theorem slope_strong_upper_bound`（強上界の抽象版：`|∂F| ≤ |∂Ent| + γ(…)`）

- E4: `Frourio/Geometry/GradientFlowFramework.lean`（新規、窓口）
  - `structure GradientFlowSystem`（`FGData`, `Ssup`, `XiNorm`, `budget`, `eps`）
  - `theorem gradient_flow_equiv`（PLFA＝EDE＝EVI＝JKO 同値、E2 を束ねる）
  - `theorem lambda_eff_lower_bound`（λ_eff 下界、E3 を束ねる）
  - `theorem two_evi_with_force`（外力付き、E1/E2 再利用）
  - `def effectiveLambdaVec` と多スケール則の命題

- E5: `Frourio/Analysis/EVI.lean` の Mosco 改修
  - 非自明 `MoscoAssumptions`（M1/M2/Tight, l.s.c.）
  - `theorem eviInheritance`（EVILimitHolds を真の命題に）

## 4. 補助補題（最低限）

- 実解析: `Real.sqrt` 単調性、`sqrt (a*b) = sqrt a * sqrt b`（非負条件付）、`sqrt (exp x) = exp (x/2)`
- 積分/安定: l.s.c. に関する liminf 補題（抽象述語で代理）
- 変分: λ-半凸の等価変形（時間再標定を含む）

## 5. 受入基準（AC）

- AC1: E1 の 5 補題（Dini/Grönwall/bridge/eviContraction）が theorem として追加、`Frourio.lean` 経由で到達。
- AC2: E2 の定義と 3 定理（ede↔evi, evi↔plfa, jko→evi）が statement→theorem で追加。Docstring に証明方針3–5行。
- AC3: E3 の `FrourioFunctional` と `lambdaEffLowerBound`, `slope_strong_upper_bound` が theorem 化。
- AC4: E4 の窓口で FG8 の同値・下界・two-EVI が再構成できる（依存 theorems の合成）。
- AC5: Mosco 側（E5）で `eviInheritance` が theorem 化（`True` スタブ脱却）。
- AC6: 既存 API 非破壊、`sorry/axiom` 不使用、`Frourio.lean` import のみでビルド通過。

## 6. 実装順序と見積り

- S1: E1（EVI 補助の定理化）: 1.0–2.0 日
- S2: E2（PLFA/EDE/JKO 定義・同値）: 1.0–1.5 日
- S3: E3（F 機能関数・定数下界）: 0.5–1.0 日
- S4: E4（FG8 窓口・多スケール）: 0.5 日
- S5: E5（Mosco theorem 化）: 1.5–3.0 日

## 7. リスクと緩和

- 測度/OT の厳密化が重い → 抽象述語で first pass、基本モデル（1次元等長化）から先行
- Grönwall/ディニの一般性 → 局所版（AC 曲線/リプシッツ）で導入し、将来一般化
- JKO 収束の正当化 → proper/l.s.c./coercive と半凸の抽象版を明確化し、テスト用の最小例で検証

## 8. 参照（ファイル）

- `Frourio/Analysis/EVI.lean:1`（EVI 補助の定理化）
- `Frourio/Analysis/DoobTransform.lean:1`（λ_BE）
- `Frourio/Geometry/FGCore.lean:1`, `MPointCalibration.lean:1`, `FGTheorems.lean:1`
- `design/13.md:1`, `papers/m点幾何学8.md:1`

---

本設計は、FG8 の変分原理を Lean で定理化するための最小核を提示する。証明の重い箇所は抽象述語で段階化しつつ、EVI/Doob/m点/Mosco の既存 API を活かして同値・下界・収束を一貫して実現する。
