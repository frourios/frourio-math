# フルーリオ幾何学 m 点一般化 LEAN4 第10フェーズ設計書（FG×m点校正）

バージョン: 1.0
対象期間: Phase G1（papers/代数学.md と papers/m点幾何学1-7.md の統合設計）
担当: 幾何/解析/代数 共同チーム（LEAN4）

## 0. 目的とスコープ

- 目的: papers/m点幾何学1-7.md の FG（Frourio Geometry）を「m 点校正」へ一般化し、既存の解析基盤（EVI/Mosco/Doob/Young/Dirac）と接続する LEAN4 設計を提示する。金属比較正 Λ に対するスケール作用と、m 点差分（代数側）を幾何に橋渡しする API を最小公倍形で定義する。
- スコープ: 定義・述語・命題を Prop/structure として先行配置。証明は後続フェーズ。既存の `Frourio/Analysis/EVI.lean`, `DoobTransform.lean`, `YoungConvolution.lean`, `Geometry/DiracIndex.lean` を破壊せず拡張。

## 1. 背景と現状（ギャップ）

- 論文:
  - 基盤（papers/代数学.md: CD⇒MLSI⇒EVI, Doob 等式, Mosco liminf, Young 剛性, Dirac 指数）…既存 Lean で骨子配置済。
  - 幾何（papers/m点幾何学1-7.md: FG データ (X,d,μ;𝓔,Λ), スケール作用 S_{Λ^k}, 相似/等長の二択 α, 生成子同次性 κ, EVI のスケール則, Doob との可換, Mosco 継承, two-EVI 同期, 解析アンカー D_{Φ,Λ}）。
- 実装（現行）:
  - EVI/Mosco/Doob は軽量 API あり（`Prop` 返し）。FG 全体を束ねる幾何データ型とスケール作用の API は未定義。m 点側の幾何インタフェース（多点記号/校正）なし。

=> 本設計で FG データ型、スケール作用、m 点校正の最小 API、主要命題のステートメントを追加する。

## 2. 成果物（Lean 追加ファイルと配置方針）

- G1: `Frourio/Geometry/FGCore.lean`
  - FG データ構造 `FGData`、距離スケールの二択（等長/相似）、準不変測度、生成子同次性。
  - スケール作用 API `ScaleAction`（Λ, act, α, κ, θ_k）。
- G2: `Frourio/Geometry/FGTheorems.lean`
  - EVI スケール則、Doob×Scale 可換の十分条件、Mosco 継承、two-EVI 同期（誤差境界）を `Prop` 命題として配置。
- G3: `Frourio/Geometry/MPointCalibration.lean`
  - m 点校正構造 `MPointCalibration`（重み/位相/シフト）、m 点記号 `phi_m`（Mellin 互換の抽象シンボル）と零点/Bohr ほぼ周期の述語。
  - 解析アンカー `D_{Φ,Λ}` との整合（2 点特例）および m 点版 `D_{Φ,Λ}^{(m)}` API（署名のみ）。
- G4: 既存連携（小改名なし）
  - `Frourio/Analysis/EVI.lean` の `EVIProblem`/`IsEVISolution` を流用。FG から `EVIProblem` を誘導するヘルパを FG 側で用意（`def` のみ）。

## 3. API/型設計（最小核）

- FG データ
  - `structure FGData (X : Type*) [PseudoMetricSpace X] [MeasurableSpace X] :=`
    - `μ : Measure X`
    - `E : X → ℝ`（エネルギ）
    - `Γ : (X → ℝ) → (X → ℝ)` / `Γ₂ : (X → ℝ) → (X → ℝ)`（高次は抽象）
    - `λ : ℝ`（CD/MLSI/EVI の係数）
  - 目的: 解析層（EVIProblem）へ写す `toEVI : FGData X → Frourio.EVIProblem X`。

- スケール作用（Λ と同次性）
  - `structure ScaleAction (X : Type*) :=`
    - `Λ : ℝ` (`1 < Λ` を別述語で保持)
    - `act : ℤ → X → X`（`k ↦ S_{Λ^k}`）
    - `isometry : Prop`（等長, α=0）/`similarity : ℝ → Prop`（相似, 指数 α）
    - `measure_quasiInvariant : (k : ℤ) → Prop`（`(S_k)_# μ = θ_k μ`）
    - `generator_homogeneous : ℝ → Prop`（κ: `S_k^{-1} 𝓛 S_k = Λ^{κ k} 𝓛`）

- FG+m 点校正
  - `structure MPointCalibration (m : ℕ) :=`
    - `weights : Fin m → ℝ`
    - `shifts  : Fin m → ℤ`（スケール位相/離散シフト）
    - `phase   : Fin m → ℝ`（必要なら）
    - 規格化述語 `normalized : Prop`（例: 重みの線形制約）
  - 記号（抽象）: `phi_m (σ τ : ℝ) : ℂ`（Mellin 線に沿う抽象シンボル）。
  - 2 点特例: `MPointCalibration 2` が代数の `D_{Φ,Λ}`（`papers/代数学.md`）に一致する旨の述語 `calib2_agrees_with_phi`。

- ユーティリティ
  - `effectiveLambda (α κ : ℝ) (Λ : ℝ) (k : ℤ) (λ : ℝ) : ℝ := Λ ^ ((κ - 2*α) * k) * λ`（相似時の係数）。

## 4. 主定理（ステートメントのみ、Prop 返し）

- G2-T1: EVI スケール則
  - `def evi_scale_rule (FG : FGData X) (S : ScaleAction X) : Prop := ...`（等長: 時間再標定で `λ ↦ Λ^{κk} λ`、相似: `λ_eff = effectiveLambda α κ Λ k λ`）。
- G2-T2: Doob×Scale 可換の十分条件
  - `def doob_scale_commute (D : Diffusion X) (S : ScaleAction X) : Prop := ...`（`(Doob h ∘ Scale) = (Scale ∘ Doob h)` を成分で主張）。
- G2-T3: Mosco 継承（可変ヒルベルト空間）
  - `def mosco_inheritance (S : MoscoSystem ι) (H : MoscoAssumptions S) : Prop := eviInheritance S H` へブリッジ。
- G2-T4: two-EVI 同期
  - `def evi_sum_with_error (P : EVIProblem X) (u v : ℝ → X) : Prop := Frourio.eviSumWithError P u v _ _ _ (MixedErrorBound.mk η ...)`。
- G3-T5: m 点記号と零点/Bohr ほぼ周期（抽象）
  - `def phi_m_zeroSet : Prop := True` / `def phi_m_bohrAlmostPeriodic : Prop := True`（将来拡張）。
- G3-T6: 解析アンカーとの整合
  - `def Dphi_m_compat (m) : Prop`（m=2 で `D_{Φ,Λ}` に一致、Mellin 記号の多点版へ拡張可能）。

## 5. 実装手順（最小ステップで CI 通過）

1) FG コア（G1）: `FGData`, `ScaleAction`, `toEVI`, `effectiveLambda` を `def/structure` で追加。証明不要。
2) FG 定理（G2）: T1〜T4 を `def … : Prop := …` で薄く包む（既存 `EVI.lean` の述語を再利用）。
3) m 点（G3）: `MPointCalibration`, `phi_m`、互換述語（T5/T6）を `Prop` として配置。2 点一致のラッパを置き、詳細は代数側に委譲。
4) 参照コメント・命名の統一（EVI 側 alias と整合、`evi_contraction` 名など）。

## 6. 依存と相互参照

- 依存: `Mathlib` 軽量（距離/測度）、既存 Frourio 解析モジュール。
- 参照ファイル:
  - 解析/EVI: `Frourio/Analysis/EVI.lean:1`
  - Doob: `Frourio/Analysis/DoobTransform.lean:1`
  - Young: `Frourio/Analysis/YoungConvolution.lean:1`
  - Dirac: `Frourio/Geometry/DiracIndex.lean:1`
  - 代数（差分/導分）: `Frourio/Algebra/StructureSequence.lean:1`, `Frourio/Algebra/NambuBracket.lean:1`
  - 論文: `papers/m点幾何学1-7.md:1`, `papers/代数学.md:1`

## 7. 受入基準（AC）

- AC1: `FGCore.lean` に FG データとスケール作用 API が定義され、`toEVI` と `effectiveLambda` が提供されている。
- AC2: `FGTheorems.lean` に EVI スケール則、Doob×Scale の可換、Mosco 継承、two-EVI 同期のステートメントが並ぶ。
- AC3: `MPointCalibration.lean` に m 点校正の型・記号・零点/Bohr 述語の器と 2 点一致のブリッジがある。
- AC4: 既存コードへ破壊的変更なし、`sorry`/`axiom` 不使用でビルド可能（Prop 返しに留める）。
- AC5: ファイル冒頭のモジュール文書に論文対応セクションを明記。

## 8. リスクと緩和

- リスク: スケール相似（α>0）の EVI 係数の数式差異が増える → `effectiveLambda` に集約し、定理ステートメントはこの関数経由に統一。
- リスク: m 点記号の解析的詳細（Mellin や零点格子）が重い → 初期は抽象 `Prop` に留め、代数側の既存実装と API ブリッジのみに限定。
- リスク: 量子/離散版の具体仮定が膨張 → `ScaleAction` の十分条件を boolean/`Prop` に分離し、拡張可能にする。

## 9. マイルストーン

- M1: FG コア型（G1）を追加し設計を固める。
- M2: FG 定理のステートメントを配置（G2）。
- M3: m 点校正の器を配置（G3）。
- M4: 既存モジュールと結合の最小サンプル（`toEVI` 経由テスト）を CI に反映。

## 10. 付記（命名方針・スタイル）

- 命名は既存設計に合わせ `snake_case`。EVI 関連は `evi_*`、Doob は `doob_*`。
- ステートメント主導の段階: すべて `def … : Prop := …` とし、将来の証明差し替えを想定。
- モジュール先頭に対応論文節（papers/m点幾何学1-7.md の該当セクション番号）を記載。

---

本設計により、FG のスケール較正（Λ, α, κ）と EVI/Mosco/Doob の既存 API が一貫に結線され、m 点校正の器を通じて代数側の m 点差分と整合できる最小核が整う。以降のフェーズで各 `Prop` を定理に昇格し、量子/離散の十分条件を具体化する。

