# FG8 Variational Principle — 残タスク設計（papers 総合）

版: 1.0  対象: PLFA＝EDE＝EVI＝JKO の証明完了に向けた残作業整理（papers/* 反映）
参照: papers/m点幾何学1-7.md, papers/m点幾何学8.md, papers/代数学.md, design/14.md

## 0. 目的と前提

- 目的: papers の主張（PLFA＝EDE＝EVI＝JKO、Doob×スケール、λ_eff 下界、two-EVI、Mosco-liminf 等）を Lean で theorem 化し、placeholder（Prop スタブ）を段階的に除去する。
- 前提: 既存 skeleton は概ね整備済。
  - `Frourio/Analysis/EVI.lean:1`（EVI/ディニ/Grönwall/収縮の骨格、現状一部 placeholder）
  - `Frourio/Analysis/PLFA.lean:1`（PLFA/EDE/JKO の述語と equivalence 梱包）
  - `Frourio/Analysis/FrourioFunctional.lean:1`（F = Ent + γ·Dσm と λ_eff 下界の包）
  - `Frourio/Geometry/FGTheorems.lean:1`（スケール則、two-EVI、FG 統合）
  - `Frourio/Geometry/GradientFlowFramework.lean:1`（GF 窓口、λ_eff、two-EVI、マルチスケール）

## 1. papers からの要請事項（Lean で必要な充当）

- m点幾何学1–7（FG 基本）：
  - スケール較正（等長/相似）と生成子同次性→EVI 定数の再標定（effective λ）。
  - Doob 変換とスケールの可換十分条件（h∘S_Λ = c·h）。
  - Mosco 極限で LSI/T2/Noether 定数の liminf。
  - two-EVI（外力）と Young 等号剛性。
  - 解析アンカー D_{Φ,Λ} の Mellin 記号・ノルム等式。
- FG8（m点／PLFA＝EDE＝EVI＝JKO）：
  - Frourio 汎関数 F = Ent + γ·D_{σ,m}(ρ) と (K1′)(K4^m)。
  - λ_BE = λ − 2ε（Doob）と m点 0 次摂動からの λ_eff 下界。
  - PLFA/EDE/EVI/JKO の同値、two-EVI（外力）、テンソル化（min）、多スケール則。
- 代数学（基盤）：
  - CD⇒MLSI⇒EVI、Doob 曲率等式、Mosco→EVI 継承、two-EVI の交差誤差仮定、Young 剛性。

## 2. 現状ギャップ（要実装・要証明）

- ディニ・Grönwall 系が `Pred`/wrapper で残存（証明未接続）
  - `Frourio/Analysis/EVI.lean:1` の `DiniUpper` はゼロ返しの仮実装、`*_pred` が多い。
- PLFA＝EDE＝EVI＝JKO の橋渡しは statement パッケージ済だが、解析フラグの実装（半凸・強上界・JKO 安定）は抽象 `True` 置き換えが残る。
- Frourio 汎関数の m点項 `Dσm` は値の箱として存在するが、`𝒦_σ`（測度変換）や sup ノルム・交換子ノルムを与える最小モデルが未接続。
- Doob×スケール・Mosco 継承は statement 段階で証明は未注入。
- two-EVI（外力）で用いる不等式→非同次 Grönwall→距離版 bridge の鎖が未閉路。
- Young 等号剛性・D_{Φ,Λ} ノルム等式は未 formalize（他ファイルに独立補題としての受け皿が必要）。

## 3. 残タスク（優先順）

1) EVI 補助（解析核）の定理化
- 追加定理（Pred 除去・wrapper 導線維持）
  - `Frourio/Analysis/EVI.lean:1`
    - D1: `DiniUpper_add_le`（加法上界）を `theorem` として証明（リプシッツ仮定→limsup 上界）
    - D2: `DiniUpper_timeRescale`（時間再標定）を `theorem` 化（σ>0, 可積分境界でOK）
    - G1: `gronwall_exponential_contraction`（同次）証明
    - G2: `gronwall_exponential_contraction_with_error_half`（非同次）証明
    - B1: `bridge_contraction_concrete` の証明（`sqrt_d2_dist_prop` 等を接続）
    - C1: `evi_contraction_thm` 系 wrapper を G1+B1 で閉路

2) PLFA＝EDE＝EVI＝JKO の証明接続
- 半凸・強上界の前提を「述語→仮定パック」に昇格し、橋渡し定理を `theorem` 化
  - `Frourio/Analysis/PLFA.lean:1`
    - P1: `PLFA_EDE_from_analytic_flags` の前提を明記化（λ-半凸＋強上界）し、EDE→EVI→PLFA を接続
    - P2: `EDE_EVI_from_analytic_flags` の橋渡しに EVI 定義と D1/D2/G1 を用いる
    - P3: `JKO_PLFA_from_analytic_flags`（proper/l.s.c./coercive＋半凸）から PLFA 曲線の存在
    - P4: `plfaEdeEviJko_equiv` を P1–P3 の合成で theorem 化（既存 API の置換）

3) Frourio 汎関数の最小モデル化（m点）
- `𝒦_σ` の抽象述語と 1D 基本モデル（log 等長）
  - 新規: `Frourio/Analysis/KTransform.lean`（提案）
    - K1: `KTransform` 構造体（`map : 𝒫₂(X) → 𝓜_+(ℝ)`, 狭義連続）と `(K1′)` を反映
    - K4: 測地親和 `(K4^m)` の述語（基本モデルでは証明、一般は仮定）
- `Frourio/Analysis/FrourioFunctional.lean:1`
    - F1: `Dsigmam` を `KTransform` からの積分で与えるインターフェース（sup ノルム引数）
    - F2: 強スロープ上界 `slope_strong_upper_bound` を K1/K4 と 0 次界から導く（述語 → theorem）

4) λ_eff 下界（Doob＋m点分離）の実装強化
- `Frourio/Analysis/FrourioFunctional.lean:1`
  - L1: `DoobCDShift` を `DoobAssumptions` に置換（`Frourio/Analysis/DoobTransform.lean:1`）
  - L2: `lambdaEffLowerBound_*` を Doob の λ_BE と m点 0 次界から導く形に整理（既存定理の強化）
  - L3: FG 窓口からの組込み確認：`Frourio/Geometry/GradientFlowFramework.lean:1`

5) two-EVI（外力）鎖の完成
- `Frourio/Analysis/EVI.lean:1` / `Frourio/Geometry/FGTheorems.lean:1`
  - T1: `eviSumWithError` → G2 で平方距離版収束 → B1 で距離版（エラー項付き）
  - T2: `TwoEVIWithForce` のパッケージを距離版まで閉じる（現状は `Prop` 合成）

6) スケール較正・Mosco・テンソル化の定理化
- `Frourio/Geometry/FGTheorems.lean:1`
  - S1: `evi_scale_rule_isometry/similarity` を `effectiveLambda` の指数形で theorem 化（W₂ のスケール則を明記）
  - S2: `doob_scale_commute` の十分条件（h∘S_Λ = c·h）を仮定として明記し、可換図式の statement→theorem 化
  - M1: `mosco_inheritance` を EVI 継承の theorem に接続（EVI 側の MoscoAssumptions を非自明化）
  - Tn: `tensorization_min_rule`（min 則）は K1′＋γ≥0 からの statement を theorem 化（first pass）

7) Young 剛性・解析アンカー（別モジュール化）
- 新規: `Frourio/Analysis/YoungRigidity.lean`（提案）
  - Y1: Young 不等式 L²×TV → L² の等号剛性の形式化（ℝ/ℤ）
- 新規: `Frourio/Analysis/PhiOperator.lean`（提案）
  - Pϕ1: D_{Φ,Λ} の Mellin 記号とノルム等式（H_σ 間）を statement 化（将来強化）

## 4. 受入基準（AC、papers 対応）

- AC1（EVI補助）: D1–G2–B1–C1 が `theorem` として追加され、`evi_contraction_thm` が閉路。
- AC2（同値）: P1–P4 で `plfaEdeEviJko_equiv` を theorem 化し、`GradientFlowFramework` から再利用可能。
- AC3（m点）: K1/K4 の述語と 1D 基本モデルの `theorem` を追加。`Dsigmam` への接続が通る。
- AC4（λ_eff）: L1–L2 により `lambda_eff_lower_bound` を `GradientFlowFramework` で起動可能。
- AC5（two-EVI）: T1–T2 により平方距離版→距離版（エラー項）まで Lean で証明接続。
- AC6（スケール/Mosco/テンソル）: S1–M1–Tn が theorem 化。
- AC7（補助）: Young 剛性と D_{Φ,Λ} が statement モジュールとして存在（後続の最適化に備える）。
- AC8（整合）: 既存 API 非破壊、`sorry/axiom` 不使用、`Frourio.lean` import のみでビルド通過。

## 5. 実装順序と見積り

- Phase A: EVI 補助（1.0–2.0 日）
- Phase B: 同値パッケージ（1.0–1.5 日）
- Phase C: m点＋λ_eff（1.0–1.5 日）
- Phase D: two-EVI（0.5–1.0 日）
- Phase E: スケール/Mosco/テンソル（1.0–2.0 日）
- Phase F: Young/Φ-operator statements（0.5 日）

## 6. リスクと緩和

- ディニ極限の一般性: 初手は AC 曲線/リプシッツに限定し、必要に応じて一般化。
- JKO 収束の技術: proper/l.s.c./coercive のチェック用に最小例（X = ℝ, Ent+二乗汎関数）で回帰テスト。
- m点の作用域: 1D 基本モデルを先行 formalize（papers 付録A/B）し、抽象化に引き上げ。

---

この設計により、papers の主結果は Lean 実装へ段階的に還元され、解析的に重い部分は first pass では述語/モデルで封じつつ、将来の厳密化に向けた拡張点（Young 剛性、Φ-operator、K 変換）が明確化される。
