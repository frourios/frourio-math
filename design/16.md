# FG8 変分原理（PLFA＝EDE＝EVI＝JKO）実装計画（残タスク設計）

本書は papers/ 下の論文群を踏まえ，Frourio 幾何学（FG）における「最小フルーリオ作用原理＝エネルギー散逸等式＝進化変分不等式＝JKO 逐次最小化」の同値と安定性を Lean で証明するための残タスクを整理する．対象となる実装の主な領域は Analysis 層・Geometry 層・Algebra/Operator 層の橋渡しである．現状は API/Prop レベルの骨組みが中心であり，計算・測度論・最適輸送の核となる補題が未実装である．

---

## 1. 論文要約と目標定理

- papers/m点幾何学1-7.md
  - FG 構造 (X,d,μ; 𝓔,Λ) とスケール作用 S_{Λ^k} の定義（距離は等長/相似）
  - CD(λ,∞) ⇒ MLSI(λ) ⇒ EVI(λ) の保存（時間再標定と相似時の λ_eff=Λ^{(κ-2α)k}λ）
  - Doob 変換の可換条件（h∘S_{Λ^k}=c_k h）と曲率補正の挙動
  - Mosco 極限での定数 liminf 安定性（LSI, T2, Noether 減衰率）
  - two‑EVI 同期（外力つき），Young 畳み込み等号剛性
  - 解析アンカー D_{Φ,Λ} の Mellin 記号・ノルム等式・零点格子

- papers/m点幾何学8.md（FG8：m点版の変分原理）
  - フルーリオ汎関数 F_{Λ,σ}(ρ)=Ent_μ(ρ)+γ·𝒟_{σ,m}(ρ)，𝒟_{σ,m}(ρ)=∫|S_m(σ+iτ)|² d(𝒦_σρ)(τ)
  - (K1′) 狭義連続，(K4^m) 変位親和（Zak–Mellin 多繊維モデルで検証）
  - Doob 劣化 λ_BE=λ−2ε と m点項の 0 次摂動評価により λ_eff の下界
    λ_eff ≥ λ_BE − γ(c_*‖S_m‖_∞² + c_D‖Ξ_m‖)
  - PLFA＝EDE＝EVI＝JKO の同値（半凸＋強上界＋l.s.c.+緊性）
  - two‑EVI（外力），Mosco‑liminf，テンソル化（min 則），多スケール（ℤ^m）

- papers/代数学.md（基盤）
  - 連続/量子/離散の EVI 公理化，CD⇒MLSI⇒EVI，Doob 変換の曲率補正式
  - Young 畳み込みの等号剛性，two‑EVI の和と誤差定義
  - Mosco と JKO 極限の継承（liminf 安定）

【目標（Lean での最終形）】
- F:=Ent+γ·𝒟_{σ,m} に対し，PLFA⇔EDE⇔EVI(λ_eff) と JKO⇒PLFA を定理化
- λ_eff の下界（Doob と m点項の寄与を分離）
- two‑EVI（外力）による同期推定（平方距離と距離版）
- Mosco‑liminf とテンソル化（min 則），多スケール EVI パラメータ則

---

## 2. 現状コードの骨組みとギャップ（未証明点）

- EVI 基盤（`Frourio/Analysis/EVI.lean`）
  - Dini 上側微分 `DiniUpper` が 0 定義のプレースホルダ
  - Grönwall（同次/非同次）や時間再標定等は Prop/ラッパのみ
  - 収縮定理は「前提を与えれば結論が出る」形（証明は未搭載）

- 変分原理パッケージ（`Frourio/Analysis/PLFA.lean`）
  - PLFA/EDE/JKO は最小主義の Prop 定義
  - 橋渡しは「解析フラグ」由来の前提として抽象化（実体未実装）

- フルーリオ汎関数（`Frourio/Analysis/FrourioFunctional.lean`）
  - 𝒟_{σ,m} は K からの代替（評価点 0）でモック
  - スロープ・強上界は抽象 Pred（実際の傾きは 0 定義）
  - λ_eff 下界は不等式を仮定すれば包装可能という形

- Doob 変換（`Frourio/Analysis/DoobTransform.lean`）
  - Diffusion と Doob 構成は与えるが，CD シフトは Assumptions 依存（未計算）

- K‑Transform／m点（`Frourio/Analysis/KTransform.lean`，`Frourio/Geometry/MPointCalibration.lean`）
  - 𝒦_σ の像は単なる関数，(K1′)(K4^m) は True/Prop の枠組み
  - m点シンボルや Ξ の評価は未導入

- FG フレーム（`Frourio/Geometry/GradientFlowFramework.lean`，`Frourio/Geometry/FGTheorems.lean`）
  - PLFA＝EDE＝EVI＝JKO と λ_eff，下界，two‑EVI を「パッケージを受け取れば主張できる」骨組みとして用意
  - 実質的な解析は上位のフラグや Assumptions に委譲

⇒ 結論：アルゴリズム的骨組みは整備済みだが，「定義の本物化（Dini 上側微分・勾配流傾き・測度変換）」「解析補題（Grönwall，EDE→EVI，JKO 収束）」「m点項の評価（‖S_m‖_∞，‖Ξ_m‖）」が未実装．

---

## 3. 実装タスク一覧（優先順位順）

1) EVI 微分計算と Grönwall（Analysis/EVI）
- Dini 上側微分の正規定義（limsup 差商），基本性質（単調性→非正，和の上界，不変量）
- 時間再標定則の証明（t↦σ t）
- Grönwall 同次/非同次版の形式化（測度論不要の実解析補題）
- two‑EVI（外力）で必要な inhomogeneous 版の整理

2) 勾配流変分原理の核（Analysis/PLFA）
- PLFA＝EDE：Dini 上側微分と単調性の橋渡しを実装
- EDE＝EVI：AGS 型（半凸＋強上界）での同値の最小版（距離空間抽象）
- JKO⇒PLFA（あるいは EDE/EVI）：l.s.c.・強緊性・最小化列の相対コンパクト性
- 解析フラグ（半凸・強上界・proper/l.s.c./coercive/JKOStable）の実体化と，必要最小限の補題群

3) K‑Transform と 𝒟_{σ,m} の本実装（Analysis/KTransform + Functional）
- 𝒦_σ: `X → Measure ℝ`（狭義連続 (K1′) の定義と証明）
- (K4^m)：W₂ 測地 t↦ρ_t に対して ν_{ρ_t}=(1−t)ν_{ρ_0}+tν_{ρ_1}（基本モデルは設計付録のとおり）
- 𝒟_{σ,m}(ρ)=∫|S_m|² d(𝒦_σρ) の l.s.c. と変位半凸（(K1′)+(K4^m)）
- 強上界：|∂F|(ρ) ≤ |∂Ent|(ρ) + γ(c_*‖S_m‖_∞² + c_D‖Ξ_m‖)

4) Doob 変換の量的実装（Analysis/DoobTransform）
- Γ・Γ₂ の補正式と Ricci 変換式の導入（∇²log h）
- CD(λ,∞) → CD(λ−2ε,∞) の証明（ε=‖∇²log h‖ の評価）
- これを λ_BE に反映（FrourioFunctional.lambdaBE と整合）

5) m点シンボル・演算子評価（Geometry/MPointCalibration + Algebra 側）
- S_m(s)=∑ α_i χ_i Λ_i^{−s} の Lean 実装と ‖S_m‖_∞ の枠組み（等リップル最小化は設計指針として外部）
- Ξ_m=h^{−1}[Δ^{⟨m⟩},h] の 0 次有界性と ‖Ξ_m‖ の上界（log‑Lip 定数）
- 2点特化で D_{Φ,Λ} と一致（Mellin 記号とノルム等式のインターフェイス）

6) FG スケールと多スケール則（Geometry/FGCore, FGTheorems）
- 相似（α）＋生成子同次（κ）から λ_eff=Λ^{(κ−2α)k}λ を EVI レベルで証明
- ℤ^m 合成の積形式（実装済みの algebraic 形を証明付に昇格）
- Doob×Scale の可換十分条件（h∘S_{Λ^k}=c_k h）→ CD 劣化と可換図式の形式化

7) Mosco‑liminf・テンソル化（Geometry/FGTheorems + Analysis/EVI）
- Kuwae–Shioya 型 Mosco の M1/M2＋緊性を Lean の Measure/Topology で具体化
- EVILimitHolds の実体化（JKO 極限で EVI 継承）
- 直積での min 則（距離・半凸・強上界の保存の最小条件）

---

## 4. 実装マップ（Lean ファイル対応）

- EVI/実解析
  - `Frourio/Analysis/EVI.lean`：DiniUpper 正規定義，Grönwall，時間再標定の証明，収縮（平方→距離）
- 変分原理パッケージ
  - `Frourio/Analysis/PLFA.lean`：PLFA⇔EDE⇔EVI の証明スケルトンを実証化，JKO⇒PLFA/EVI
- フルーリオ汎関数
  - `Frourio/Analysis/FrourioFunctional.lean`：|∂F| の定義（メトリック勾配），強上界の証明，λ_eff 下界のパイプライン
- Doob 変換
  - `Frourio/Analysis/DoobTransform.lean`：Γ–Γ₂ 補正・Ricci 変換・CD シフトの定理化
- K‑Transform / m点
  - `Frourio/Analysis/KTransform.lean`：𝒦_σ: X→Measure ℝ，（K1′）と（K4^m），𝒟_{σ,m} の l.s.c./半凸
  - `Frourio/Geometry/MPointCalibration.lean`：S_m，Ξ_m，2点一致と記号計算のインターフェイス
- FG フレーム
  - `Frourio/Geometry/GradientFlowFramework.lean`：λ_eff 下界の統合（Doob＋m点）
  - `Frourio/Geometry/FGTheorems.lean`：PLFA＝EDE＝EVI＝JKO パッケージの実証化，two‑EVI 距離版，Mosco/テンソル化

---

## 5. 最低限の補題セット（導入順）

- 実解析
  - limsup による上側ディニ微分の基本補題（単調性，和の上界，合成鎖則の弱形式）
  - Grönwall（同次，非同次 half 版）
- 最適輸送／メトリック勾配流（AGS 最小主義）
  - メトリック傾き |∂F| と EDE の関係（半凸＋強上界）
  - JKO 逐次最小化の相対コンパクト性と極限曲線の存在
- 測度変換／m点
  - 𝒦_σ の狭義連続（連続写像の押し出し＋連続汎関数との合成）
  - 変位親和（基本モデルに対する直積・繊維分解の補題）
  - ∫|S_m|² dν の下半連続性と測地半凸
- Doob
  - Γ–Γ₂ 補正と Ricci 変換の導出（3 行導出に対応する補題列）

---

## 6. 成功判定（Done の定義）

- F:=Ent+γ·𝒟_{σ,m} について
  - Lean 上で `plfaEdeEviJko_equiv (FrourioFunctional.F ...) (lambdaBE ...)` を定理として取得
  - `lambda_eff_lower_bound` に実体ある証明（Doob＋m点 0 次評価からの構成）
  - two‑EVI（外力）平方距離の線形誤差上界と距離版の橋渡しが証明付き
  - スケール則，Mosco‑liminf，テンソル化（min）が Prop でなく定理化

---

## 7. マイルストーン（短→中期）

- M1: EVI 基盤の本物化（Dini/Grönwall/収縮；2〜3 ファイル）
- M2: PLFA＝EDE の実装と JKO 最小版（l.s.c./緊性）
- M3: K と 𝒟_{σ,m} の l.s.c./半凸＋強上界（c_*, c_D, ‖S_m‖_∞, ‖Ξ_m‖ を外生パラメータとして受ける）
- M4: Doob CD シフトの定理化 → λ_BE 反映
- M5: PLFA＝EDE＝EVI＝JKO の一括証明と FG フレーム統合
- M6: two‑EVI（外力）と多スケール・Mosco・テンソル化の仕上げ

---

## 8. 依存関係と実装上の注意

- Mathlib 依存：実解析（limsup, exp/log），測度（Measure），距離空間（PseudoMetricSpace），必要に応じて最適輸送は抽象化して回避
- 重い一般性は避け，まず基本モデル（1D, Zak–Mellin）から証明し，抽象化を持ち上げる
- 等リップル設計（‖S_m‖_∞ 最小化）は Lean 外（設計/付録の LP）で行い，Lean 側は値をパラメータとして受け取る
- 既存の Prop/Assumption を徐々に theorem に置換．互換 API を維持（壊さない）

---

## 9. トレーサビリティ（主要コード接続）

- EVI: `Frourio/Analysis/EVI.lean`（Dini, Grönwall, contraction, two‑EVI）
- 変分原理: `Frourio/Analysis/PLFA.lean`（PLFA⇔EDE⇔EVI, JKO⇒PLFA）
- 機能層: `Frourio/Analysis/FrourioFunctional.lean`（F と λ_eff）
- Doob: `Frourio/Analysis/DoobTransform.lean`（CD シフト）
- K/m点: `Frourio/Analysis/KTransform.lean`, `Frourio/Geometry/MPointCalibration.lean`
- FG: `Frourio/Geometry/GradientFlowFramework.lean`, `Frourio/Geometry/FGTheorems.lean`

以上．

